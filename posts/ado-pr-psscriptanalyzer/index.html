<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Azure DevOps PowerShell code analysis with Pull Request comments | CloudLumberjack</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Azure DevOps PowerShell code analysis with Pull Request comments" /><meta name="author" content="Andrew Campbell" /><meta property="og:locale" content="en_US" /><meta name="description" content="Get static code analysis feedback on your PowerShell code hosted in Azure DevOps, using pipelines to create inline file comments within your pull requests." /><meta property="og:description" content="Get static code analysis feedback on your PowerShell code hosted in Azure DevOps, using pipelines to create inline file comments within your pull requests." /><link rel="canonical" href="https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/" /><meta property="og:url" content="https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/" /><meta property="og:site_name" content="CloudLumberjack" /><meta property="og:image" content="https://cloudlumberjack.com/assets/img/ado-analyzer/ado-analyzer-social2.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-01T00:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://cloudlumberjack.com/assets/img/ado-analyzer/ado-analyzer-social2.png" /><meta property="twitter:title" content="Azure DevOps PowerShell code analysis with Pull Request comments" /><meta name="twitter:site" content="@acampb_" /><meta name="twitter:creator" content="@Andrew Campbell" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/"},"description":"Get static code analysis feedback on your PowerShell code hosted in Azure DevOps, using pipelines to create inline file comments within your pull requests.","@type":"BlogPosting","url":"https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/","headline":"Azure DevOps PowerShell code analysis with Pull Request comments","dateModified":"2020-11-01T00:00:00-04:00","datePublished":"2020-11-01T00:00:00-04:00","image":"https://cloudlumberjack.com/assets/img/ado-analyzer/ado-analyzer-social2.png","author":{"@type":"Person","name":"Andrew Campbell"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-P32E6G6KFG"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P32E6G6KFG'); </script> <script src="/app.js" defer></script><meta property="og:description" content="" /><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/lumberjack.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">CloudLumberjack</a></div><div class="site-subtitle font-italic">A blog about cloud, DevOps, Azure, PowerShell, automation, and whatever else</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/acampb" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/acampb_" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/acampb" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['andrewbcampbell','outlook.com'].join('@')" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Azure DevOps PowerShell code analysis with Pull Request comments</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Azure DevOps PowerShell code analysis with Pull Request comments</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 1, 2020, 12:00 AM -0400" > Nov 1, 2020 <i class="unloaded">2020-11-01T00:00:00-04:00</i> </span> by <span class="author"> Andrew Campbell </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 18, 2021, 2:00 PM -0500" > Jan 18 <i class="unloaded">2021-01-18T14:00:41-05:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/ado-analyzer-social2.png" class="post-preview-img"><h2 id="overview">Overview</h2><p>If you are using PowerShell you should be storing your code in a code repository. <a href="https://github.com" target="_blank">GitHub</a> and <a href="https://dev.azure.com" target="_blank">Azure DevOps</a> are great choices, but really any git repo will do. This isn’t an article about why you should be using version control, I feel that’s been covered at great length in the community already.</p><p>This article is going to walk through leveraging Azure DevOps to perform static code analysis using <a href="https://github.com/PowerShell/PSScriptAnalyzer" target="_blank">PSScriptAnalyzer</a> as part of a Pull Request workflow. Our pull request will initiate PSScriptAnalyzer, gather the results, and post each issue as a comment on the offending line of code in the pull request.</p><p>The file and folder structure can be modified to suit the needs of any other repo, but for the purposes of this article we’ll be using the following:</p><ul><li><code class="language-plaintext highlighter-rouge">/azure-pipelines.yml</code>: The Azure DevOps pipeline yaml code; this installs PSScriptAnalyzer on the hosted agent, then runs our custom script to analyze a directory and post comments back to the Pull Request which initiated the pipeline.<li><code class="language-plaintext highlighter-rouge">/tests/Start-PSScriptAnalyzer.ps1</code>: The custom PowerShell script which runs PSScriptAnalyzer, performs a for-each loop through the results, and then posts a comment on the specific file and line where the issue was detected.<li><code class="language-plaintext highlighter-rouge">/scripts/example-script.ps1</code>: A sample script with a few errors that will cause PSScriptAnalyzer to produce warnings.</ul><p>These files can all be downloaded from my GitHub repo here: <a href="https://github.com/acampb/azuredevops-psscriptanalyzer-prcomments" target="_blank">https://github.com/acampb/azuredevops-psscriptanalyzer-prcomments</a></p><hr /><h2 id="create-the-azure-devops-pipeline">Create the Azure DevOps Pipeline</h2><p>Start by adding the <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script to a new directory in your repo named <code class="language-plaintext highlighter-rouge">tests</code>. Grab the file from my GitHub repo above, or copy the code block below:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">CmdletBinding</span><span class="p">()]</span><span class="w">
</span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="c"># Directory where PowerShell scripts to be tested are stored. Use a relative path like '../scripts'. Script Analyzer will recurse through subdirectories as well</span><span class="w">
    </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">)]</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="w">
    </span><span class="nv">$ScriptDirectory</span><span class="p">,</span><span class="w">

    </span><span class="c"># Comma separated list of specific PSScriptAnalyzer rules to exclude</span><span class="w">
    </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="p">)]</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="w">
    </span><span class="nv">$ScriptAnalyzerExcludeRules</span><span class="w">

</span><span class="p">)</span><span class="w">

</span><span class="kr">function</span><span class="w"> </span><span class="nf">Add-PRComment</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="p">[</span><span class="n">CmdletBinding</span><span class="p">()]</span><span class="w">
</span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">)]</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="w">
    </span><span class="nv">$Body</span><span class="w">
</span><span class="p">)</span><span class="w">
    </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Posting PR Comment via AzureDevOps REST API"</span><span class="w">

    </span><span class="c"># post the comment to the pull request</span><span class="w">
    </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="si">$(</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">SYSTEM_TEAMFOUNDATIONCOLLECTIONURI</span><span class="si">)</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">SYSTEM_TEAMPROJECTID</span><span class="s2">/_apis/git/repositories/</span><span class="si">$(</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">BUILD_REPOSITORY_NAME</span><span class="si">)</span><span class="s2">/pullRequests/</span><span class="si">$(</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">SYSTEM_PULLREQUEST_PULLREQUESTID</span><span class="si">)</span><span class="s2">/threads?api-version=5.1"</span><span class="w">
        </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Constructed URL: </span><span class="nv">$uri</span><span class="s2">"</span><span class="w">

        </span><span class="nv">$response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-RestMethod</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">POST</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="nx">Authorization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Bearer </span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">SYSTEM_ACCESSTOKEN</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="nv">$Body</span><span class="w"> </span><span class="nt">-ContentType</span><span class="w"> </span><span class="nx">application/json</span><span class="w">

        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Rest API posted OK"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Error</span><span class="w"> </span><span class="bp">$_</span><span class="w">
        </span><span class="n">Write-Error</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Exception</span><span class="o">.</span><span class="nf">Message</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$ScriptAnalyzerRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ScriptAnalyzerRule</span><span class="w"> </span><span class="nt">-Severity</span><span class="w"> </span><span class="nx">Error</span><span class="p">,</span><span class="w"> </span><span class="nx">Warning</span><span class="p">,</span><span class="w"> </span><span class="nx">Information</span><span class="w">
</span><span class="nv">$ScriptAnalyzerResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-ScriptAnalyzer</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$ScriptDirectory</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-IncludeRule</span><span class="w"> </span><span class="nv">$ScriptAnalyzerRules</span><span class="w"> </span><span class="nt">-ExcludeRule</span><span class="w"> </span><span class="nv">$ScriptAnalyzerExcludeRules</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">$ScriptAnalyzerResult</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$ScriptAnalyzerResultString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$ScriptAnalyzerResult</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-String</span><span class="w">
    </span><span class="nx">Write-Warning</span><span class="w"> </span><span class="nv">$ScriptAnalyzerResultString</span><span class="w">

    </span><span class="c"># loop through each result and post to the azuredevops rest api</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$ScriptAnalyzerResult</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># build the script path for the PR comment, drop the workdir from the path</span><span class="w">
        </span><span class="nv">$ScriptPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">ScriptPath</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="p">[</span><span class="n">regex</span><span class="p">]::</span><span class="n">Escape</span><span class="p">(</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">SYSTEM_DEFAULTWORKINGDIRECTORY</span><span class="p">),</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"ScriptPath: </span><span class="nv">$ScriptPath</span><span class="s2">"</span><span class="w">
        </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Line Number: </span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Line</span><span class="si">)</span><span class="s2">"</span><span class="w">
        </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Message: </span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Message</span><span class="si">)</span><span class="s2">"</span><span class="w">


        </span><span class="c"># build the markdown comments</span><span class="w">
        </span><span class="c"># cannot be tabbed over to match indentation</span><span class="w">
        </span><span class="nv">$markdownComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
:warning: Script Analyzer found this issue with your code:

</span><span class="se">``</span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Message</span><span class="si">)</span><span class="se">``</span><span class="sh">
"@</span><span class="w">


        </span><span class="nv">$body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
{
    "comments": [
        {
            "parentCommentId": 0,
            "content": "</span><span class="nv">$markdownComment</span><span class="sh">",
            "commentType": 1
        }
    ],
    "status": "active",
    "threadContext": {
        "filePath": "</span><span class="nv">$ScriptPath</span><span class="sh">",
        "leftFileEnd": null,
        "leftFileStart": null,
        "rightFileEnd": {
            "line": </span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Line</span><span class="si">)</span><span class="sh">,
            "offset": 100
        },
        "rightFileStart": {
            "line": </span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Line</span><span class="si">)</span><span class="sh">,
            "offset": 1
        }
    }
}
"@</span><span class="w">
        </span><span class="c"># post to the PR</span><span class="w">
        </span><span class="n">Add-PRComment</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="nv">$body</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="kr">throw</span><span class="w"> </span><span class="s2">"PSScriptAnalyzer found issues with your code"</span><span class="w">

</span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"All Script Analyzer tests passed"</span><span class="w">

    </span><span class="nv">$markdownComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
:white_check_mark: Script Analyzer found no issues with your code! High Five! :hand:
"@</span><span class="w">

    </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s2">"Posting PR Comment via AzureDevOps REST API"</span><span class="w">

    </span><span class="nv">$body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
{
    "comments": [
        {
            "parentCommentId": 0,
            "content": "</span><span class="nv">$markdownComment</span><span class="sh">",
            "commentType": 1
        }
    ],
    "status": "closed"
}
"@</span><span class="w">
    </span><span class="c"># post to the PR</span><span class="w">
    </span><span class="n">Add-PRComment</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="nv">$body</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/add-analyzer-script.png" alt="add-analyzer-script" /></p><p>I’m committing my changes directly to the <code class="language-plaintext highlighter-rouge">master</code> branch in the screenshot above. This is generally a bad practice; and later we’ll setup a branch policy to prevent this from happening, forcing updates to <code class="language-plaintext highlighter-rouge">master</code> to occur through the pull request process.</p><p>For demonstrating the pipeline and PSScriptAnalyzer I’ve created an example script with several errors intentionally included so we can see PSScriptAnalyzer generate some warnings. If you want to use this file in your repo you can grab it here: <a href="https://github.com/acampb/azuredevops-psscriptanalyzer-prcomments/blob/main/scripts/example-script.ps1" target="_blank">https://github.com/acampb/azuredevops-psscriptanalyzer-prcomments/blob/main/scripts/example-script.ps1</a></p><p>Now let’s create our Azure DevOps Pipeline yaml file (<code class="language-plaintext highlighter-rouge">azure-pipelines.yml</code>) in the root of our repo. Use the code block below, or grab the file directly from the GitHub repo.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="na">trigger</span><span class="pi">:</span>
  <span class="s">none</span>

<span class="na">jobs</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PSScriptAnalyzer'</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">PSScriptAnalyzer</span>
  <span class="na">pool</span><span class="pi">:</span>
    <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>

  <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">PowerShell@2</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Install</span><span class="nv"> </span><span class="s">ScriptAnalyzer'</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">targetType</span><span class="pi">:</span> <span class="s">inline</span>
        <span class="na">pwsh</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">Install-Module -Name 'PSScriptAnalyzer' -Scope 'CurrentUser' -Force</span>
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">PowerShell@2</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Analyze</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">post</span><span class="nv"> </span><span class="s">PR</span><span class="nv"> </span><span class="s">Comment'</span>
      <span class="na">env</span><span class="pi">:</span>
          <span class="na">SYSTEM_ACCESSTOKEN</span><span class="pi">:</span> <span class="s">$(System.AccessToken)</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">targetType</span><span class="pi">:</span> <span class="s">filePath</span>
        <span class="na">pwsh</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">filePath</span><span class="pi">:</span> <span class="s">$(Build.Repository.LocalPath)/tests/Start-PSScriptAnalyzer.ps1</span>
        <span class="na">arguments</span><span class="pi">:</span> <span class="s1">'</span><span class="s">-ScriptDirectory</span><span class="nv"> </span><span class="s">$(Build.Repository.LocalPath)/scripts'</span>
</pre></table></code></div></div><blockquote><p>Note: You may need to adjust the <code class="language-plaintext highlighter-rouge">filePath</code> parameter to where you stored the <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script, and the <code class="language-plaintext highlighter-rouge">arguments</code> to the directory where your PowerShell scripts are located.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/add-azure-pipelines.png" alt="add-azure-pipelines" /></p><p>Commit this file to the repo as well.</p><p>Simply creating the <code class="language-plaintext highlighter-rouge">azure-pipelines.yml</code> file does not actually create the Pipeline, we’ve just stored a yaml file in our repo. Follow these steps to create the Pipeline using our existing <code class="language-plaintext highlighter-rouge">azure-pipelines.yml</code> file.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/create-pipeline.gif" alt="create-pipeline" /></p><ol><li>Click <code class="language-plaintext highlighter-rouge">Pipelines</code><li>Click <code class="language-plaintext highlighter-rouge">Create Pipeline</code><li>Select <code class="language-plaintext highlighter-rouge">Azure Repos Git</code> for code repo location<li>Select your git repo<li>Azure DevOps will most likely detect our <code class="language-plaintext highlighter-rouge">azure-pipelines.yml</code> file, however you may need to specify the file to use if you used a different file name, or have existing pipelines configured.<li>Do not run the pipeline, click the down arrow and click ‘Save’<li>The default pipeline name will be based on the Repo name, click <code class="language-plaintext highlighter-rouge">...</code> and <code class="language-plaintext highlighter-rouge">Rename/move</code>, and change the name to <strong>PSScriptAnalyzer</strong></ol><blockquote><p>Note: The pipeline will not run correctly if it is started outside of a Pull Request. This is due to the way the <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script is written; it requires the pull request id to properly post a comment via the API.</p></blockquote><hr /><h2 id="configure-build-service-permissions">Configure Build Service Permissions</h2><p>When the pipeline executes our <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script it is going to be running under the identity of the ‘Build Service’ user, and will attempt connect to the Azure DevOps REST API to add comments to our Pull Request. There are two pre-requisites for this to work correctly:</p><ul><li><strong>Access Token</strong>: The <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script needs the access token for the Build Service user so it can authenticate with the Azure DevOps REST API. This is already configured in our <code class="language-plaintext highlighter-rouge">azure-pipelines.yml</code> file. This creates an Environmental variable named <code class="language-plaintext highlighter-rouge">SYSTEM_ACCESSTOKEN</code> which the script can use.</ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
    <span class="na">SYSTEM_ACCESSTOKEN</span><span class="pi">:</span> <span class="s">$(System.AccessToken)</span>
</pre></table></code></div></div><ul><li><strong>Permissions</strong>: The ‘Build Service’ user itself needs to be granted permissions to interact with Pull Requests. By default this is not allowed and must be configured. Follow these steps to configure the permissions:</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/build-service-permissions.gif" alt="build-service-permissions" /></p><ol><li>Click <code class="language-plaintext highlighter-rouge">Project Settings</code><li>Navigate to <code class="language-plaintext highlighter-rouge">Repos \ Repositories</code><li>Click the <code class="language-plaintext highlighter-rouge">Permissions</code> tab<li>Select the <code class="language-plaintext highlighter-rouge">ProjectName Build Service</code> user<li>Change the permision for <code class="language-plaintext highlighter-rouge">Contribute to pull requests</code> to <strong>Allow</strong></ol><hr /><h2 id="configure-build-verification-policy">Configure Build Verification Policy</h2><p>We have all of our pre-requisites in place and are ready to tie everything together. We’re going to accomplish that by configuring two settings:</p><ul><li><p><strong>Branch Policy</strong>: This will stop anyone from committing directly to the <code class="language-plaintext highlighter-rouge">master</code> branch, and force them to use the pull request process.</p><li><p><strong>Build Verification</strong>: This will configure any pull request to run our pipeline, evaluate our code with PSScriptAnalyzer, and receive feedback through the pull request comment system.</p></ul><p>Follow these steps to configure our policies:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/build-validation.gif" alt="build-validation" /></p><ol><li>Click <code class="language-plaintext highlighter-rouge">Project Settings</code><li>Navigate to <code class="language-plaintext highlighter-rouge">Repos \ Repositories</code><li>Click on your repo name<li>Select the <code class="language-plaintext highlighter-rouge">Policies</code> tab<li>Under ‘Branch Policies’ click the <code class="language-plaintext highlighter-rouge">master</code> branch<li>Under Branch Policies set <code class="language-plaintext highlighter-rouge">Require a minimum number of reviewers</code> to <strong>On</strong><li>Under Build Validation click the <code class="language-plaintext highlighter-rouge">+</code><li>Select the <code class="language-plaintext highlighter-rouge">PSScriptAnalyzer</code> build pipeline and click <strong>Save</strong></ol><hr /><h2 id="create-a-pull-request-to-validate">Create a Pull Request to Validate</h2><p>To confirm everything is working as expected let’s create a new branch, add some code, and open a pull request.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/pull-request.gif" alt="pull-request" /></p><p>The build validation policy we created should kick off our PSScriptAnalyzer pipeline when the pull request is opened. In the overview the pull request you should see that the required check has not yet been run, and is either queued or in progress.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/pull-request-build.png" alt="pull-request-build" /></p><p>The <code class="language-plaintext highlighter-rouge">Start-PSScriptAnalyzer.ps1</code> script executed by the pipeline will evaulate our PowerShell code and when issues are found it will connect to the Azure DevOps REST API and post a comment. The comment will be linked to the specific file, and line of code identified by PSScriptAnalyzer, and provide the detailed error information.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/code-line-comment.png" alt="code-line-comment" /></p><p>If PSScriptAnalyzer finds issues with the PowerShell code the script will exit with an exception (after posting the comments). This will flag the build validation as failing, and prevent the pull request from being merged into <code class="language-plaintext highlighter-rouge">master</code>.</p><p>Updating the code failing the PSScriptAnalyzer tests and pushing new commits to our branch will trigger our pipeline to run again, and re-evaluate our code. If all of our code passes the PSScriptAnalyzer analysis our build will be marked as passing, and a comment will be left in the pull request indicating everything is correct.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/success-comment.png" alt="success-comment" /></p><h2 id="troubleshooting">Troubleshooting</h2><h3 id="pullrequestcontribute-error">PullRequestContribute error</h3><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"$id"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="nl">"innerException"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"TF401027: You need
     | the Git 'PullRequestContribute' permission to perform this
     | action. Details: identity
     | 'Build</span><span class="se">\\</span><span class="s2">0ef135cb-8cdd-4557-a536-e6f20b82b4b9', scope
     | 'repository'."</span><span class="p">,</span><span class="nl">"typeName"</span><span class="p">:</span><span class="s2">"Microsoft.TeamFoundation.Git.Server.GitNeedsPermissionException, Microsoft.TeamFoundation.Git.Server"</span><span class="p">,</span><span class="nl">"typeKey"</span><span class="p">:</span><span class="s2">"GitNeedsPermissionException"</span><span class="w">
</span></pre></table></code></div></div><p>If you are encountering this error in your pipeline it means the project Build Service user account does not have access to contribute (ie, post a comment) to a pull request. Review the steps to <a href="#configure-build-service-permissions">Configure Build Service Permissions</a></p><h3 id="add--verbose-for-additional-output">Add <code class="language-plaintext highlighter-rouge">-Verbose</code> for additional output</h3><p>Both PowerShell tasks in the pipeline support adding the <code class="language-plaintext highlighter-rouge">-Verbose</code> switch for additional output. This can be helpful in troubleshooting if you are encountering another issue.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/add-verbose.png" alt="add-verbose" /></p><p>The task output in the pipeline execution will include all verbose output from the script.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/ado-analyzer/verbose-output.png" alt="verbose-output" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azuredevops/" class="post-tag no-text-decoration" >AzureDevOps</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >PowerShell</a> <a href="/tags/pullrequest/" class="post-tag no-text-decoration" >PullRequest</a> <a href="/tags/cicd-pipeline/" class="post-tag no-text-decoration" >CICD Pipeline</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Azure DevOps PowerShell code analysis with Pull Request comments - CloudLumberjack&url=https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://cloudlumberjack.com/posts/ado-pr-psscriptanalyzer/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/azureautotagger/">Serverless tagging with Event Grid and Azure Functions</a><li><a href="/posts/start-with-why/">Start with why</a><li><a href="/posts/setup-github-verified-commits-for-vscode/">Setup GitHub verified commits for VSCode</a><li><a href="/posts/powerup-your-powershell-prompt/">PowerUp your PowerShell prompt</a><li><a href="/posts/ado-pr-psscriptanalyzer/">Azure DevOps PowerShell code analysis with Pull Request comments</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/powerup-your-powershell-prompt/"><div class="card-body"> <span class="timeago small" > Dec 19, 2020 <i class="unloaded">2020-12-19T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PowerUp your PowerShell prompt</h3><div class="text-muted small"><p> Overview One of the great things about PowerShell is that is so extensible and customizable. When sharing my screen with co-workers and customers a frequent exchange happens: “Oh, what shell a...</p></div></div></a></div><div class="card"> <a href="/posts/github-actions-approvals/"><div class="card-body"> <span class="timeago small" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GitHub Actions now with Manual Approvals</h3><div class="text-muted small"><p> Overview I’ve loved GitHub Actions since they were released, but the one piece I always felt was missing was some kind of gating or more control around deployments. Now we can add manual approval ...</p></div></div></a></div><div class="card"> <a href="/posts/azureautotagger/"><div class="card-body"> <span class="timeago small" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Serverless tagging with Event Grid and Azure Functions</h3><div class="text-muted small"><p> Overview Azure AutoTagger is a lightweight, low-cost serverless solution that can easily be deployed to an Azure subscription. Once deployed Azure AutoTagger monitors for ResourceWriteSucess event...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/setup-github-verified-commits-for-vscode/" class="btn btn-outline-primary"><p>Setup GitHub verified commits for VSCode</p></a> <a href="/posts/powerup-your-powershell-prompt/" class="btn btn-outline-primary"><p>PowerUp your PowerShell prompt</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/acampb_">Andrew Campbell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cloudlumberjack.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
