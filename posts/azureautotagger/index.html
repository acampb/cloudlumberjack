<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Serverless tagging with Event Grid and Azure Functions | CloudLumberjack</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Serverless tagging with Event Grid and Azure Functions" /><meta name="author" content="Andrew Campbell" /><meta property="og:locale" content="en_US" /><meta name="description" content="Quickly deploy a serverless solution using Event Grid and Functions to automate tagging of Azure resources with last modified data." /><meta property="og:description" content="Quickly deploy a serverless solution using Event Grid and Functions to automate tagging of Azure resources with last modified data." /><link rel="canonical" href="https://cloudlumberjack.com/posts/azureautotagger/" /><meta property="og:url" content="https://cloudlumberjack.com/posts/azureautotagger/" /><meta property="og:site_name" content="CloudLumberjack" /><meta property="og:image" content="https://cloudlumberjack.com/assets/img/autotagger/autotagger-logo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-06T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://cloudlumberjack.com/assets/img/autotagger/autotagger-logo.png" /><meta property="twitter:title" content="Serverless tagging with Event Grid and Azure Functions" /><meta name="twitter:site" content="@acampb_" /><meta name="twitter:creator" content="@Andrew Campbell" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://cloudlumberjack.com/posts/azureautotagger/"},"description":"Quickly deploy a serverless solution using Event Grid and Functions to automate tagging of Azure resources with last modified data.","@type":"BlogPosting","url":"https://cloudlumberjack.com/posts/azureautotagger/","headline":"Serverless tagging with Event Grid and Azure Functions","dateModified":"2021-01-06T00:00:00-05:00","datePublished":"2021-01-06T00:00:00-05:00","image":"https://cloudlumberjack.com/assets/img/autotagger/autotagger-logo.png","author":{"@type":"Person","name":"Andrew Campbell"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-P32E6G6KFG"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P32E6G6KFG'); </script> <script src="/app.js" defer></script><meta property="og:description" content="" /><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/lumberjack.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">CloudLumberjack</a></div><div class="site-subtitle font-italic">A blog about cloud, DevOps, Azure, PowerShell, automation, and whatever else</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/acampb" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/acampb_" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/acampb" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['andrewbcampbell','outlook.com'].join('@')" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Serverless tagging with Event Grid and Azure Functions</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Serverless tagging with Event Grid and Azure Functions</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 6, 2021, 12:00 AM -0500" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span> by <span class="author"> Andrew Campbell </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 4, 2021, 8:19 AM -0500" > Mar 4 <i class="unloaded">2021-03-04T08:19:41-05:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/autotagger/autotagger-logo.png" class="post-preview-img"><h1 id="overview">Overview</h1><p>Azure AutoTagger is a lightweight, low-cost serverless solution that can easily be deployed to an Azure subscription. Once deployed Azure AutoTagger monitors for <code class="language-plaintext highlighter-rouge">ResourceWriteSucess</code> events within the subscription and triggers an Azure Function to automatically apply a <code class="language-plaintext highlighter-rouge">LastModifiedTimestamp</code> and <code class="language-plaintext highlighter-rouge">LastModifiedBy</code> tag. Any organization should develop and implement it’s own tagging strategy (<a href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-tagging" target="_blank">Azure’s Cloud Adoption Framework is a great start</a>). This solution can be a complimentary piece to a more comprehensive tagging strategy, and can be useful when deployed to test/development/sandbox subscriptions where resources <em>sometimes</em> have a habit of sticking around longer than they were intended.</p><ul><li><p><a href="https://github.com/acampb/AzureAutoTagger" target="_blank"><strong>https://github.com/acampb/AzureAutoTagger</strong></a>: Contains the ARM template code to deploy the infrastructure and role assignments to the subscription</p><li><p><a href="https://github.com/acampb/AzureAutoTaggerFunction" target="_blank"><strong>https://github.com/acampb/AzureAutoTaggerFunction</strong></a>: Contains the Azure Function PowerShell code</p></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/autotagger/tagging-spedup.gif" alt="tagging" /></p><h2 id="deployment">Deployment</h2><blockquote><p>Important: You must have <strong>Owner</strong> permissions on the subscription you intend to deploy this to. The template will create a managed identity and assign it to the <code class="language-plaintext highlighter-rouge">Reader</code> and <code class="language-plaintext highlighter-rouge">Tag Contributor</code> roles.</p></blockquote><p>Use the <strong>Deploy to Azure</strong> button to easily deploy this solution in a subscription</p><p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Facampb%2FAzureAutoTagger%2Fmain%2Fazuredeploy.json"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://aka.ms/deploytoazurebutton" alt="Deploy to Azure" /></a></p><p>– OR –</p><ol><li>Clone the GitHub repo locally</ol><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>git clone https://github.com/acampb/AzureAutoTagger.git
</pre></table></code></div></div><ol><li>Initiate an ARM Template deployment with Azure PowerShell or Azure CLI</ol><p>Azure PowerShell:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">New-AzDeployment</span><span class="w"> </span><span class="nt">-Location</span><span class="w"> </span><span class="s2">"East US"</span><span class="w"> </span><span class="nt">-TemplateFile</span><span class="w"> </span><span class="s2">".\azuredeploy.json"</span><span class="w"> </span><span class="nt">-resourceGroupName</span><span class="w"> </span><span class="s2">"rg-autotagger"</span><span class="w"> </span><span class="nt">-Verbose</span><span class="w">
</span></pre></table></code></div></div><p>Azure CLI:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">az</span> <span class="n">deployment</span> <span class="n">create</span> <span class="o">--</span><span class="n">location</span> <span class="s">"West US"</span> <span class="o">--</span><span class="n">template</span><span class="o">-</span><span class="nb">file</span> <span class="s">".</span><span class="se">\a</span><span class="s">zuredeploy.json"</span> <span class="o">--</span><span class="n">parameters</span> <span class="n">resourceGroupName</span><span class="o">=</span><span class="n">rg</span><span class="o">-</span><span class="n">autotagger</span>
</pre></table></code></div></div><h2 id="event-grid">Event Grid</h2><p>Azure Event Grid allows you to build applications with event-based architectures. Configure the Azure resource you would like to subscribe to, and then give the event handler or WebHook endpoint to send the event to. Event Grid has built-in support for events coming from Azure services, like storage blobs, resource groups, and subscriptions. Event Grid also has support for your own events, using custom topics.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/autotagger/event-grid.png" alt="event-grid" /></p><p>There are five concepts in Azure Event Grid that let you get going:</p><ul><li><strong>Events</strong> - JSON data describing what happened.<li><a href="https://docs.microsoft.com/en-us/azure/event-grid/overview#event-sources" target="_blank"><strong>Event Sources</strong></a> - Azure service the event took place (or custom). In this solution this is the Azure Subscription itself.<li><strong>Topics</strong> - The deployed Azure resource (endpoint) where publishers send events.<li><strong>Event subscriptions</strong> - The endpoint or built-in mechanism to route events, sometimes to more than one handler. Subscriptions are also used by handlers to intelligently filter incoming events.<li><a href="https://docs.microsoft.com/en-us/azure/event-grid/overview#event-handlers" target="_blank"><strong>Event handlers</strong></a> - The app or service reacting to the event. In this solution we are using an Azure Function App</ul><p>The Azure AutoTagger solution starts by creating an Event Grid System Topic configured with the Azure subscription as the event source. An Event Subscription is then configured to consume the events emitted by the Azure subscription. The Event Subscription only routes events of the type <code class="language-plaintext highlighter-rouge">ResourceWriteSuccess</code>, so we are only sending events to this subscription when a resource is written (created or changed). The Event Subscription is connected to the Azure Function App as it’s Event Handler.</p><p>The events emitted by the Azure Subscription are standard JSON payloads describing what resource was changed, and the authentication claim of the identity initiating performing the resource write operation. Below is a sample event JSON from the Azure documentation:</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="p">[{</span><span class="w">
  </span><span class="nl">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/{subscription-id}/resourcegroups/{resource-group}/providers/Microsoft.Storage/storageAccounts/{storage-name}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Resources.ResourceWriteSuccess"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"eventTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-19T18:38:04.6117357Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4db48cba-50a2-455a-93b4-de41a3b5b7f6"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"authorization"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/{subscription-id}/resourcegroups/{resource-group}/providers/Microsoft.Storage/storageAccounts/{storage-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage/storageAccounts/write"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"evidence"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subscription Admin"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"claims"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{audience-claim}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{issuer-claim}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{issued-at-claim}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"nbf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{not-before-claim}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{expiration-claim}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_claim_names"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">groups</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">src1</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_claim_sources"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">src1</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">endpoint</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">{URI}</span><span class="se">\"</span><span class="s2">}}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/claims/authnclassreference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"aio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{token}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/claims/authnmethodsreferences"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rsa,mfa"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"appid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"appidacr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/2012/01/devicecontext/claims/identifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"e_exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{expiration}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{last-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{first-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ipaddr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{IP-address}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{full-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/identity/claims/objectidentifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"onprem_sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"puid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/identity/claims/scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_impersonation"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.microsoft.com/identity/claims/tenantid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{user-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{user-name}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"uti"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"correlationId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{ID}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resourceProvider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resourceUri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/{subscription-id}/resourcegroups/{resource-group}/providers/Microsoft.Storage/storageAccounts/{storage-name}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"operationName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage/storageAccounts/write"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Succeeded"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"subscriptionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{subscription-id}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tenantId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{tenant-id}"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dataVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadataVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"topic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/subscriptions/{subscription-id}"</span><span class="w">
</span><span class="p">}]</span><span class="w">
</span></pre></table></code></div></div><p>The event JSON contains some interesting data that we will utilize later within our Azure function, notably the <code class="language-plaintext highlighter-rouge">ResourceUri</code> and some claim information about the user or service principal performing the operation. The Event Subscription is configured to trigger our Azure Function to execute on a new event and will pass this JSON data object to the Function as a parameter in our PowerShell script.</p><p>You may be thinking “wait, wont the Azure Function writing tags create an endless loop of insanity?”. Yes, yes it will, unless we configure some additional filtering. Within the Event Grid Subscription configure we also create an advanced filter to exclude the event if the <code class="language-plaintext highlighter-rouge">$data.claims.appid</code> matches the appid of the Azure Function’s identity.</p><h2 id="azure-function">Azure Function</h2><p>Azure Functions is a serverless solution that allows you to write less code, maintain less infrastructure, and save on costs. Instead of worrying about deploying and maintaining servers, the cloud infrastructure provides all the up-to-date resources needed to keep your applications running.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/autotagger/functions.png" alt="functions" /></p><p>A PowerShell Azure Function is represented as a PowerShell script that executes when triggered. Each function script has a related <code class="language-plaintext highlighter-rouge">function.json</code> file that defines how the function behaves, such as how it’s triggered and its input and output parameters.</p><p>PowerShell Functions take in parameters that match the names of all the input bindings defined in the <code class="language-plaintext highlighter-rouge">function.json</code> file. A <code class="language-plaintext highlighter-rouge">TriggerMetadata</code> parameter is also passed that contains additional information on the trigger that started the function.</p><p>The Azure AutoTagger solution deploys a Function App containing a single PowerShell script Function named <code class="language-plaintext highlighter-rouge">AutoTagger</code>. The <code class="language-plaintext highlighter-rouge">AutoTagger</code> Function executes a PowerShell script which parses the JSON data provided from the Event Grid for which user or service principal modified the Azure resource, and what Resource Uri was modified. The script then creates a hashtable and updates the tags on the resource. The code performs an <code class="language-plaintext highlighter-rouge">Update-AzTag -Merge</code> operation so any existing tags are preserved.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="kr">param</span><span class="p">(</span><span class="nv">$eventGridEvent</span><span class="p">,</span><span class="w"> </span><span class="nv">$TriggerMetadata</span><span class="p">)</span><span class="w">

</span><span class="c"># Make sure to pass hashtables to Out-String so they're logged correctly</span><span class="w">
</span><span class="c">#$eventGridEvent | Out-String | Write-Host</span><span class="w">

</span><span class="c"># uncomment for claims detail for debugging</span><span class="w">
</span><span class="c">#Write-Output $eventGridEvent.data.claims | Format-List</span><span class="w">

</span><span class="nv">$name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$eventGridEvent</span><span class="o">.</span><span class="nf">data</span><span class="o">.</span><span class="nf">claims</span><span class="o">.</span><span class="nf">name</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"NAME: </span><span class="nv">$name</span><span class="s2">"</span><span class="w">

</span><span class="nv">$appid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$eventGridEvent</span><span class="o">.</span><span class="nf">data</span><span class="o">.</span><span class="nf">claims</span><span class="o">.</span><span class="nf">appid</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"APPID: </span><span class="nv">$appid</span><span class="s2">"</span><span class="w">

</span><span class="nv">$email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$eventGridEvent</span><span class="o">.</span><span class="nf">data</span><span class="o">.</span><span class="nf">claims</span><span class="o">.</span><span class="s1">'http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress'</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"EMAIL: </span><span class="nv">$email</span><span class="s2">"</span><span class="w">

</span><span class="nv">$time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="nx">o</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"TIMESTAMP: </span><span class="nv">$time</span><span class="s2">"</span><span class="w">

</span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$eventGridEvent</span><span class="o">.</span><span class="nf">data</span><span class="o">.</span><span class="nf">resourceUri</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"URI: </span><span class="nv">$uri</span><span class="s2">"</span><span class="w">


</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-AzResource</span><span class="w"> </span><span class="nt">-ResourceId</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Stop</span><span class="w">

    </span><span class="kr">If</span><span class="w"> </span><span class="p">((</span><span class="nv">$resource</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w">
        </span><span class="p">(</span><span class="nv">$resource</span><span class="o">.</span><span class="nf">ResourceId</span><span class="w"> </span><span class="o">-notlike</span><span class="w"> </span><span class="s1">'*Microsoft.Resources/deployments*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">

        </span><span class="n">Write-Output</span><span class="w"> </span><span class="s1">'Attempting to tag resource'</span><span class="w">

        </span><span class="kr">If</span><span class="w"> </span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$lastModifiedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$email</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$lastModifiedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$appid</span><span class="w">
        </span><span class="p">}</span><span class="w">

        </span><span class="nv">$tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
            </span><span class="s2">"LastModifiedBy"</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">$lastModifiedBy</span><span class="w">
            </span><span class="s2">"LastModifiedTimeStamp"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$time</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Update-AzTag</span><span class="w"> </span><span class="nt">-ResourceId</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-Tag</span><span class="w"> </span><span class="nv">$tags</span><span class="w"> </span><span class="nt">-Operation</span><span class="w"> </span><span class="nx">Merge</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Encountered error writing tag, may be a resource that does not support tags."</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Output</span><span class="w"> </span><span class="s1">'Excluded resource type'</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Not able query the resource Uri. This could be due to a permissions problem (identity needs reader); or not a resource we can query"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="azure-resources-deployed">Azure Resources Deployed</h2><p>The entire solution consists of the six resources (pictured below) deployed to the Resource Group, and two Azure Role Assignments.</p><p>All of the resources are suffixed using the ARM template function <code class="language-plaintext highlighter-rouge">uniqueString</code> derived from the Azure Subscription id. This is to avoid naming conflicts on the resources which require global uniqueness.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/autotagger/autotagger-rg.png" alt="autotagger-rg" /></p><p>The Event Grid and Function App are the core components of the solution, the additional resources are deployed in support of the Azure Function:</p><ul><li><strong>Storage Account</strong>: A storage account is required for Azure Functions to operate.<li><strong>App Service Plan</strong>: The App Service Plan is the hosting plan for the Azure Function. The plan provides the compute and memory for the function, and controls additional functionality. The deployment template defaults to the <code class="language-plaintext highlighter-rouge">Consumption</code> plan for the lowest possible cost, but this could be upgraded later if required.<li><strong>Application Insights</strong>: Application Insights is deployed and configured in order to provide troubleshooting and log streaming capabilities.<li><strong>User Assigned Managed Identity</strong>: A User assigned managed identity is created and assigned to the Azure Function. When the Function’s PowerShell code is executed it is authenticated to the Azure subscription using this identity. This managed identity is also assigned to the <code class="language-plaintext highlighter-rouge">Reader</code> and <code class="language-plaintext highlighter-rouge">Tag Contributor</code> RBAC roles.</ul><h2 id="arm-template-deployment">ARM Template Deployment</h2><p>This ARM Template performs a subscription level deployment. It will initiate several linked deployments to deploy and configure all of the resources required in the solution.</p><ul><li><p>Create a new Resource Group with the name specified in the parameter <code class="language-plaintext highlighter-rouge">resourceGroupName</code>. Defaults to <code class="language-plaintext highlighter-rouge">rg-autotagger</code> if no other value is specified</p><li><p>Perform a linked template deployment to create the Event Grid and Function App resources. Uses <a href="https://github.com/acampb/AzureAutoTagger/blob/main/eventgridfunction.json" target="_blank">https://github.com/acampb/AzureAutoTagger/blob/main/eventgridfunction.json</a></p><ul><li><p>Create the User Assigned Managed Identity</p><li><p>Create the App Service plan</p><li><p>Create the Storage Account</p><li><p>Create the Function App</p><li><p>Configure the Function App source control to deploy the PowerShell function from the application repo: <a href="https://github.com/acampb/AzureAutoTaggerFunction"><strong>https://github.com/acampb/AzureAutoTaggerFunction</strong></a></p><li><p>Create the Event Grid System Topic using the subscription as a source</p><li><p>Create the Event Grid Subscription, configured to include only <code class="language-plaintext highlighter-rouge">ResourceWriteSuccess</code> events, and an advanced filter to exclude events from the Managed Identity App Id</p><li><p>Create the Application Insights</p><li><p>Output the Managed Identity Principal Id</p></ul><li><p>Perform a linked template deployment to assign the Managed Identity to the <code class="language-plaintext highlighter-rouge">Reader</code> role. Uses <a href="https://github.com/acampb/AzureAutoTagger/blob/main/rbac.json" target="_blank">https://github.com/acampb/AzureAutoTagger/blob/main/rbac.json</a></p><li><p>Perform a linked template deployment to assign the Managed Identity to the <code class="language-plaintext highlighter-rouge">Tag Contributor</code> role. Uses <a href="https://github.com/acampb/AzureAutoTagger/blob/main/rbac.json" target="_blank">https://github.com/acampb/AzureAutoTagger/blob/main/rbac.json</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/arm-template/" class="post-tag no-text-decoration" >ARM Template</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >PowerShell</a> <a href="/tags/serverless/" class="post-tag no-text-decoration" >Serverless</a> <a href="/tags/functions/" class="post-tag no-text-decoration" >Functions</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Serverless tagging with Event Grid and Azure Functions - CloudLumberjack&url=https://cloudlumberjack.com/posts/azureautotagger/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://cloudlumberjack.com/posts/azureautotagger/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/azureautotagger/">Serverless tagging with Event Grid and Azure Functions</a><li><a href="/posts/start-with-why/">Start with why</a><li><a href="/posts/setup-github-verified-commits-for-vscode/">Setup GitHub verified commits for VSCode</a><li><a href="/posts/powerup-your-powershell-prompt/">PowerUp your PowerShell prompt</a><li><a href="/posts/ado-pr-psscriptanalyzer/">Azure DevOps PowerShell code analysis with Pull Request comments</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/powerup-your-powershell-prompt/"><div class="card-body"> <span class="timeago small" > Dec 19, 2020 <i class="unloaded">2020-12-19T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PowerUp your PowerShell prompt</h3><div class="text-muted small"><p> Overview One of the great things about PowerShell is that is so extensible and customizable. When sharing my screen with co-workers and customers a frequent exchange happens: “Oh, what shell a...</p></div></div></a></div><div class="card"> <a href="/posts/ado-pr-psscriptanalyzer/"><div class="card-body"> <span class="timeago small" > Nov 1, 2020 <i class="unloaded">2020-11-01T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure DevOps PowerShell code analysis with Pull Request comments</h3><div class="text-muted small"><p> Overview If you are using PowerShell you should be storing your code in a code repository. GitHub and Azure DevOps are great choices, but really any git repo will do. This isn’t an article about w...</p></div></div></a></div><div class="card"> <a href="/posts/github-actions-approvals/"><div class="card-body"> <span class="timeago small" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GitHub Actions now with Manual Approvals</h3><div class="text-muted small"><p> Overview I’ve loved GitHub Actions since they were released, but the one piece I always felt was missing was some kind of gating or more control around deployments. Now we can add manual approval ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/github-actions-approvals/" class="btn btn-outline-primary"><p>GitHub Actions now with Manual Approvals</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/acampb_">Andrew Campbell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cloudlumberjack.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
