<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GitHub Actions now with Manual Approvals | CloudLumberjack</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="GitHub Actions now with Manual Approvals" /><meta name="author" content="Andrew Campbell" /><meta property="og:locale" content="en_US" /><meta name="description" content="Implement deployment gating with manual approvals in GitHub Actions, now available with the Environments feature." /><meta property="og:description" content="Implement deployment gating with manual approvals in GitHub Actions, now available with the Environments feature." /><link rel="canonical" href="https://cloudlumberjack.com/posts/github-actions-approvals/" /><meta property="og:url" content="https://cloudlumberjack.com/posts/github-actions-approvals/" /><meta property="og:site_name" content="CloudLumberjack" /><meta property="og:image" content="https://cloudlumberjack.com/assets/img/gh-approvals/notification1.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-06T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://cloudlumberjack.com/assets/img/gh-approvals/notification1.png" /><meta property="twitter:title" content="GitHub Actions now with Manual Approvals" /><meta name="twitter:site" content="@acampb_" /><meta name="twitter:creator" content="@Andrew Campbell" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://cloudlumberjack.com/posts/github-actions-approvals/"},"description":"Implement deployment gating with manual approvals in GitHub Actions, now available with the Environments feature.","@type":"BlogPosting","url":"https://cloudlumberjack.com/posts/github-actions-approvals/","headline":"GitHub Actions now with Manual Approvals","dateModified":"2021-01-06T00:00:00-05:00","datePublished":"2021-01-06T00:00:00-05:00","image":"https://cloudlumberjack.com/assets/img/gh-approvals/notification1.png","author":{"@type":"Person","name":"Andrew Campbell"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-P32E6G6KFG"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P32E6G6KFG'); </script> <script src="/app.js" defer></script><meta property="og:description" content="" /><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/lumberjack.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">CloudLumberjack</a></div><div class="site-subtitle font-italic">A blog about cloud, DevOps, Azure, PowerShell, automation, and whatever else</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/acampb" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/acampb_" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/acampb" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['andrewbcampbell','outlook.com'].join('@')" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>GitHub Actions now with Manual Approvals</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GitHub Actions now with Manual Approvals</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 6, 2021, 12:00 AM -0500" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span> by <span class="author"> Andrew Campbell </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Jan 7, 2021, 8:57 AM -0500" > Jan 7 <i class="unloaded">2021-01-07T08:57:39-05:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/notification1.png" class="post-preview-img"><h2 id="overview">Overview</h2><p>I’ve loved GitHub Actions since they were released, but the one piece I always felt was missing was some kind of gating or more control around deployments. Now we can add manual approval requirements to our workflows through GitHubs new <strong>Environments</strong> configurations. Environments also support environment specific secrets in additional to repository-wide secrets.</p><h2 id="create-environments">Create Environments</h2><p>To demo environments and approvals I’ve created a simple .net web app, along with two Azure Web Apps (dev and prod). We’ll setup GitHub Actions to deploy our code to our Azure Web Apps.</p><p>Let’s start by creating our first environment for our project. From your GitHub repo access <strong>Settings</strong>, and you should now see <strong>Environments</strong> in the left menu.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/env1.png" alt="env1" /></p><p>Click <strong>New environment</strong>, provide a name, and click <strong>Configure environment</strong>.</p><div class="table-wrapper"><table><tbody><tr><td>Note: If you target an environment name in your GitHub Actions workflow file and that environment name does not exist GitHub will automatically create it for you. Only repository admins can configure environments with required reviewers, timers, and secrets.</table></div><p>Check the box for <strong>Required reviewers</strong> and enter at least user or team name, and click <strong>Save protection rules</strong>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/reviewer1.png" alt="reviewer1" /></p><p>For this project I’ve created a <code class="language-plaintext highlighter-rouge">dev</code> environment and a <code class="language-plaintext highlighter-rouge">prod</code> environment. You can create as many environments as required to suit your needs.</p><h2 id="configure-github-actions">Configure GitHub Actions</h2><p>At a high level the workflow I need for this project looks like this:</p><ul><li>Build the .NET application<li>Automatically deploy the application to <code class="language-plaintext highlighter-rouge">dev</code><li>After approval, deploy the application to <code class="language-plaintext highlighter-rouge">prod</code></ul><p>Now that we have the environments created, we can reference them within our GitHub Actions workflow file. Environments are referenced at the <strong>job</strong> level, so we will utilize three separate jobs.</p><p>The code snippet below illustrates how the environments are referenced in each job with the <code class="language-plaintext highlighter-rouge">environment: name</code> key-value pair. I’ve removed the individual steps within each job for readability.</p><div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-and-publish</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>

  <span class="na">deploy-dev</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s1">'</span><span class="s">dev'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build-and-publish</span>
    <span class="na">steps</span><span class="pi">:</span>

  <span class="na">deploy-prod</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s1">'</span><span class="s">prod'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build-and-publish</span><span class="pi">,</span> <span class="nv">deploy-dev</span><span class="pi">]</span>
    <span class="na">steps</span><span class="pi">:</span>
</pre></table></code></div></div><p>When any job references an environment the protection rules of that environment are enforced before any steps within that job are started. Because we are referencing two different environments we need to seperate our steps into different jobs, aligned to the environments.</p><p>GitHub Actions will attempt to execute all jobs in parallel. This is great for performance when jobs are not dependent on other jobs. Our workflow however does contain dependencies, so we must express those using the <code class="language-plaintext highlighter-rouge">needs:</code> configuration within each job.</p><p>Using multiple jobs also means that GitHub is initializing a new <code class="language-plaintext highlighter-rouge">ubuntu-latest</code> runner instance for each job. The files created by our .NET build job will be saved locally (and lost), so we will need to publish our .NET build artifact. The artifact is then downloaded with each deploy job. The full workflow code for this is shown later.</p><h2 id="configure-environment-secrets">Configure Environment Secrets</h2><p>Our Azure environment contains two Web Apps (dev and prod), in order to deploy our code we are going to use the <strong>Publish Profile</strong> from each within our GitHub Actions workflow.</p><p>The publish profile is a block of XML code containing connectivity and authentication information that GitHub Actions can utilize to deploy our code to our Web App. This can be downloaded as a zipped XML file directly from the Azure Portal, or easily retrieved from the Az CLI.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>az webapp deployment list-publishing-profiles <span class="nt">--name</span> WEBAPP_NAME <span class="nt">--resource-group</span> RESOURCE_GROUP_NAME <span class="nt">--xml</span>
</pre></table></code></div></div><p>Each Azure Web App will have it’s own unique publish profile. We’re going to store each as a secret in our GitHub Environments.</p><p>From our GitHub repo access <strong>Settings</strong>, <strong>Environments</strong>, and click on an environment to configure. Under Environment secrets, click <strong>Add secret</strong>.</p><p>Use the secret name <strong>AZURE_WEBAPP_PUBLISH_PROFILE</strong>, and paste the XML block in the value, and click Add secret.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/secret1.png" alt="secret1" /></p><p>Once we’ve added the <strong>AZURE_WEBAPP_PUBLISH_PROFILE</strong> secret to our first environment (<code class="language-plaintext highlighter-rouge">dev</code>), repeat the steps to add a secret with the same name to our second environment (<code class="language-plaintext highlighter-rouge">prod</code>). Make sure you grab the publish profile XML code from the prod environment and add that to the secret value.</p><p>Now that we have the secrets stored in each environment we can reference them from our GitHub Actions workflow yaml file.</p><p>In the code snippet below notice that the <code class="language-plaintext highlighter-rouge">Deploy to Azure WebApp</code> step is accessing our secret using <code class="language-plaintext highlighter-rouge">$</code>. Because this job is referencing our <code class="language-plaintext highlighter-rouge">dev</code> environment, GitHub will use the secret stored in that environment.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>  <span class="na">deploy-dev</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s1">'</span><span class="s">dev'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build-and-publish</span>
    <span class="na">steps</span><span class="pi">:</span>

      <span class="c1"># Download published artifact</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">published-app</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>

      <span class="c1"># Deploy to web app</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Azure WebApp</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/webapps-deploy@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">app-name</span><span class="pi">:</span> <span class="s">app-cloudlumberjack-dev</span>
          <span class="na">publish-profile</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">package</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>
</pre></table></code></div></div><h2 id="full-workflow-example">Full workflow example</h2><p>Below is the full GitHub Actions workflow yaml file to perform our application deployment, utilizing environments.</p><p>All of the code used for this article is available at my GitHub repo: <a href="https://github.com/acampb/github-environments">https://github.com/acampb/github-environments</a></p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Deploy</span><span class="nv"> </span><span class="s">ASP.NET</span><span class="nv"> </span><span class="s">Core</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Azure</span><span class="nv"> </span><span class="s">Web</span><span class="nv"> </span><span class="s">App'</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">main"</span>

<span class="na">env</span><span class="pi">:</span>
  <span class="na">DOTNET_VERSION</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.1.404'</span>


<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-and-publish</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>

      <span class="c1"># Checkout the repo</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@master</span>

      <span class="c1"># Setup .NET Core SDK</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup .NET Core</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-dotnet@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">dotnet-version</span><span class="pi">:</span> <span class="s">$</span>

      <span class="c1"># Run dotnet build and publish</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dotnet build and publish</span>
        <span class="na">working-directory</span><span class="pi">:</span> <span class="s1">'</span><span class="s">app'</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">dotnet restore</span>
          <span class="s">dotnet build --configuration Release</span>
          <span class="s">dotnet publish -c Release -o './published-app'</span>

      <span class="c1"># Publish artifact</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">published-app</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./app/published-app'</span>

  <span class="na">deploy-dev</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s1">'</span><span class="s">dev'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build-and-publish</span>
    <span class="na">steps</span><span class="pi">:</span>

      <span class="c1"># Download published artifact</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">published-app</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>

      <span class="c1"># Deploy to web app</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Azure WebApp</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/webapps-deploy@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">app-name</span><span class="pi">:</span> <span class="s">app-cloudlumberjack-dev</span>
          <span class="na">publish-profile</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">package</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>

  <span class="na">deploy-prod</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s1">'</span><span class="s">prod'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build-and-publish</span><span class="pi">,</span> <span class="nv">deploy-dev</span><span class="pi">]</span>
    <span class="na">steps</span><span class="pi">:</span>

      <span class="c1"># Download published artifact</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Download artifact</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/download-artifact@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">published-app</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>

      <span class="c1"># Deploy to web app</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Azure WebApp</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/webapps-deploy@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">app-name</span><span class="pi">:</span> <span class="s">app-cloudlumberjack-prod</span>
          <span class="na">publish-profile</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">package</span><span class="pi">:</span> <span class="s1">'</span><span class="s">./published-app'</span>
</pre></table></code></div></div><h2 id="approvals-in-action">Approvals in action</h2><p>Our workflow is triggered by pushing to <code class="language-plaintext highlighter-rouge">main</code>, which will build and publish our application, deploy it to our dev environment, then wait for approval before deploying to prod. When viewing our workflow in GitHub we can see the <code class="language-plaintext highlighter-rouge">deploy-prod</code> job is waiting for approval.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/workflow1.png" alt="workflow1" /></p><p>Clicking <strong>Review deployments</strong> allows us to provide our approval and add some comments.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/approval1.png" alt="approval1" /></p><p>The deployment approval history is captured along with the workflow actions, providing some traceability to who approved, and any comments they supplied.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/history1.png" alt="history1" /></p><p>When approvals are required GitHub will also send the required reviews an email notification.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/gh-approvals/email1.png" alt="email1" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/github/" class="post-tag no-text-decoration" >GitHub</a> <a href="/tags/github-actions/" class="post-tag no-text-decoration" >GitHub Actions</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a> <a href="/tags/cicd-pipeline/" class="post-tag no-text-decoration" >CICD Pipeline</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GitHub Actions now with Manual Approvals - CloudLumberjack&url=https://cloudlumberjack.com/posts/github-actions-approvals/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://cloudlumberjack.com/posts/github-actions-approvals/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/azureautotagger/">Serverless tagging with Event Grid and Azure Functions</a><li><a href="/posts/start-with-why/">Start with why</a><li><a href="/posts/setup-github-verified-commits-for-vscode/">Setup GitHub verified commits for VSCode</a><li><a href="/posts/powerup-your-powershell-prompt/">PowerUp your PowerShell prompt</a><li><a href="/posts/ado-pr-psscriptanalyzer/">Azure DevOps PowerShell code analysis with Pull Request comments</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/setup-github-verified-commits-for-vscode/"><div class="card-body"> <span class="timeago small" > Oct 25, 2020 <i class="unloaded">2020-10-25T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Setup GitHub verified commits for VSCode</h3><div class="text-muted small"><p> Want to see that sweet Verified status on your GitHub commit history? This guide walks through how to setup and configure everything needed on a Windows system! Install GnuPG (GPG) I’m a big fan ...</p></div></div></a></div><div class="card"> <a href="/posts/ado-pr-psscriptanalyzer/"><div class="card-body"> <span class="timeago small" > Nov 1, 2020 <i class="unloaded">2020-11-01T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Azure DevOps PowerShell code analysis with Pull Request comments</h3><div class="text-muted small"><p> Overview If you are using PowerShell you should be storing your code in a code repository. GitHub and Azure DevOps are great choices, but really any git repo will do. This isn’t an article about w...</p></div></div></a></div><div class="card"> <a href="/posts/azureautotagger/"><div class="card-body"> <span class="timeago small" > Jan 6 <i class="unloaded">2021-01-06T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Serverless tagging with Event Grid and Azure Functions</h3><div class="text-muted small"><p> Overview Azure AutoTagger is a lightweight, low-cost serverless solution that can easily be deployed to an Azure subscription. Once deployed Azure AutoTagger monitors for ResourceWriteSucess event...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/powerup-your-powershell-prompt/" class="btn btn-outline-primary"><p>PowerUp your PowerShell prompt</p></a> <a href="/posts/azureautotagger/" class="btn btn-outline-primary"><p>Serverless tagging with Event Grid and Azure Functions</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/acampb_">Andrew Campbell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/github/">GitHub</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/cicd-pipeline/">CICD Pipeline</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/misc/">misc</a> <a class="post-tag" href="/tags/windows-terminal/">Windows Terminal</a> <a class="post-tag" href="/tags/vscode/">VSCode</a> <a class="post-tag" href="/tags/serverless/">Serverless</a> <a class="post-tag" href="/tags/pullrequest/">PullRequest</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cloudlumberjack.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
